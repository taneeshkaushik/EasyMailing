{"ast":null,"code":"import _regeneratorRuntime from \"/home/abhishek/Projects/Stp-II/Fuse-React-v3.0.0-skeleton/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/abhishek/Projects/Stp-II/Fuse-React-v3.0.0-skeleton/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/abhishek/Projects/Stp-II/Fuse-React-v3.0.0-skeleton/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/abhishek/Projects/Stp-II/Fuse-React-v3.0.0-skeleton/src/app/main/academy/crp/tabs/SheetUpload.js\";\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState, useRef } from 'react';\nimport { readString } from 'react-papaparse';\nimport CourseList from '../usables/CourseList';\nimport axios from 'axios';\nimport { gapi } from 'gapi-script';\nimport { encode, decode } from 'js-base64';\nimport TextField from '@material-ui/core/TextField';\nimport ProgressBar from '../usables/ProgressBar';\nimport DoneAllIcon from '@material-ui/icons/DoneAll';\nimport { ListItem } from '@material-ui/core';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    button: {\n      margin: theme.spacing(1)\n    },\n    input: {\n      display: 'none'\n    }\n  };\n});\nexport default function SheetUpload(props) {\n  var classes = useStyles();\n\n  var _React$useState = React.useState({}),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      fileState = _React$useState2[0],\n      setFileState = _React$useState2[1];\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      signedInUser = _useState2[0],\n      setSignedInUser = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isLoadingGoogleMailApi = _useState4[0],\n      setIsLoadingGoogleMailApi = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isApiLoaded = _useState6[0],\n      setIsApiLoaded = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      cnt = _useState8[0],\n      setCnt = _useState8[1];\n\n  var onFileChange = function onFileChange(event) {\n    if (event.target.files[0] == undefined) return;\n    setFileState({\n      selectedFile: event.target.files[0]\n    });\n    console.log(event.target.result);\n    var reader = new FileReader();\n\n    reader.onload =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(event) {\n        var text, row_temp, col_setup, row_setup, i, temp, j;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                text = event.target.result;\n                console.log(text);\n                row_temp = readString(text).data;\n                console.log(row_temp);\n                col_setup = [];\n                row_setup = [];\n\n                for (i = 0; i < row_temp[0].length; i++) {\n                  col_setup.push({\n                    Header: row_temp[0][i],\n                    accessor: row_temp[0][i],\n                    sortable: true,\n                    className: \"font-bold justify-center\"\n                  });\n                }\n\n                console.log(col_setup);\n\n                for (i = 1; i < row_temp.length && row_temp[i].length > 1; i++) {\n                  temp = {};\n\n                  for (j = 0; j < row_temp[i].length; j++) {\n                    temp[row_temp[0][j]] = row_temp[i][j];\n                  }\n\n                  row_setup.push(temp);\n                }\n\n                console.log(row_setup);\n                props.setColumns(col_setup);\n                props.setRows(row_setup);\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    reader.readAsText(event.target.files[0]);\n    setCnt(0);\n  };\n\n  var CLIENT_ID = '1067508074985-pgsioeadhbkpv79l18dvodcunr5cgkp9.apps.googleusercontent.com';\n  var API_KEY = 'AIzaSyAeYEXpe2vPm2gEcYQk_EG6tWLmAjkjtJI';\n  var DISCOVERY_DOCS = [\"https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest\"];\n  var SCOPES = 'https://mail.google.com/';\n\n  var _useState9 = useState(),\n      _useState10 = _slicedToArray(_useState9, 2),\n      user = _useState10[0],\n      setUser = _useState10[1];\n\n  var handleClientLoad = function handleClientLoad() {\n    gapi.load('client:auth2', initClient);\n  };\n\n  var initClient = function initClient() {\n    setIsLoadingGoogleMailApi(true);\n    gapi.client.init({\n      apiKey: API_KEY,\n      clientId: CLIENT_ID,\n      discoveryDocs: DISCOVERY_DOCS,\n      scope: SCOPES\n    }).then(function () {\n      // Listen for sign-in state changes.\n      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);\n      console.log('inside'); // Handle the initial sign-in state.\n\n      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get()); //gapi.auth2.getAuthInstance().signOut();\n    }, function (error) {});\n  };\n\n  var updateSigninStatus = function updateSigninStatus(isSignedIn) {\n    if (isSignedIn) {\n      // Set the signed in user\n      console.log(gapi.auth2.getAuthInstance().currentUser);\n      setSignedInUser(gapi.auth2.getAuthInstance().currentUser.le.wt);\n      setIsLoadingGoogleMailApi(false);\n      setIsApiLoaded(true); // list files if user is authenticated\n\n      var subject = 'Subject: ' + props.subject + '\\n\\n';\n      props.row.map(function (value) {\n        var msg = 'To: ' + '<' + value.email + '>' + '\\n';\n        msg += subject + props.body + '\\n';\n\n        for (var i in value) {\n          if (i == 'email') continue;\n          if (props.list.indexOf(i) == -1) continue;\n          msg += i;\n          msg += ' :- ';\n          msg += value[i];\n          msg += '\\n';\n        }\n\n        sendMail(encode(msg));\n      });\n    } else {\n      // prompt user to sign in\n      handleAuthClick();\n    }\n  };\n  /**\n  * List files.\n  */\n\n\n  function sendMail(message) {\n    gapi.client.gmail.users.messages.send({\n      'userId': 'me',\n      \"raw\": message\n    }).then(function (response) {\n      // alert(\"Email sent successfully\");\n      setCnt(function (prevProgress) {\n        return prevProgress >= 100 ? prevProgress : prevProgress + 100 / props.row.length;\n      });\n    }).catch(function (err) {\n      console.log(err);\n    });\n  }\n  /**\n   *  Sign in the user upon button click.\n   */\n\n\n  var handleAuthClick = function handleAuthClick(event) {\n    gapi.auth2.getAuthInstance().signIn();\n  };\n\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    color: \"inherit\",\n    type: \"file\",\n    accept: \".csv\",\n    onChange: onFileChange,\n    onClick: function onClick() {\n      setCnt(0);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }), React.createElement(\"label\", {\n    htmlFor: \"outlined-button-file\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }), React.createElement(Button, {\n    variant: \"outlined\",\n    color: \"inherit\",\n    component: \"span\",\n    className: classes.button,\n    onClick: function onClick() {\n      handleClientLoad();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, \"Send Email\"), React.createElement(ListItem, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }, React.createElement(ProgressBar, {\n    color: \"secondary\",\n    progress: cnt,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"p-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, cnt >= 100 ? React.createElement(DoneAllIcon, {\n    color: \"secondary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }) : null)));\n}","map":{"version":3,"sources":["/home/abhishek/Projects/Stp-II/Fuse-React-v3.0.0-skeleton/src/app/main/academy/crp/tabs/SheetUpload.js"],"names":["Button","makeStyles","React","useEffect","useState","useRef","readString","CourseList","axios","gapi","encode","decode","TextField","ProgressBar","DoneAllIcon","ListItem","CircularProgress","useStyles","theme","button","margin","spacing","input","display","SheetUpload","props","classes","fileState","setFileState","signedInUser","setSignedInUser","isLoadingGoogleMailApi","setIsLoadingGoogleMailApi","isApiLoaded","setIsApiLoaded","cnt","setCnt","onFileChange","event","target","files","undefined","selectedFile","console","log","result","reader","FileReader","onload","text","row_temp","data","col_setup","row_setup","i","length","push","Header","accessor","sortable","className","temp","j","setColumns","setRows","readAsText","CLIENT_ID","API_KEY","DISCOVERY_DOCS","SCOPES","user","setUser","handleClientLoad","load","initClient","client","init","apiKey","clientId","discoveryDocs","scope","then","auth2","getAuthInstance","isSignedIn","listen","updateSigninStatus","get","error","currentUser","le","wt","subject","row","map","value","msg","email","body","list","indexOf","sendMail","handleAuthClick","message","gmail","users","messages","send","response","prevProgress","catch","err","signIn"],"mappings":"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","sourcesContent":["import Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState, useRef } from 'react';\nimport { readString } from 'react-papaparse';\nimport CourseList from '../usables/CourseList'\nimport axios from 'axios';\nimport { gapi } from 'gapi-script';\nimport { encode, decode } from 'js-base64';\nimport TextField from '@material-ui/core/TextField';\nimport ProgressBar from '../usables/ProgressBar';\nimport DoneAllIcon from '@material-ui/icons/DoneAll';\nimport {ListItem} from '@material-ui/core';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nconst useStyles = makeStyles(theme => ({\n    button: {\n        margin: theme.spacing(1),\n    },\n    input: {\n        display: 'none',\n    },\n}));\nexport default function SheetUpload(props) {\n    const classes = useStyles();\n    const [fileState, setFileState] = React.useState({});\n    const [signedInUser, setSignedInUser] = useState();\n    const [isLoadingGoogleMailApi, setIsLoadingGoogleMailApi] = useState(false);\n    const [isApiLoaded, setIsApiLoaded] = useState(false);\n    const [cnt, setCnt] = useState(0);\n    const onFileChange = (event) => {\n\n        if(event.target.files[0]==undefined)\n            return; \n        \n        setFileState({ selectedFile: event.target.files[0] });\n        console.log(event.target.result);\n        const reader = new FileReader()\n        reader.onload = async (event) => {\n            const text = (event.target.result)\n            console.log(text);\n            var row_temp = readString(text).data;\n            console.log(row_temp);\n            var col_setup = [];\n            var row_setup = [];\n            for (var i = 0; i < row_temp[0].length; i++) {\n                col_setup.push({\n                    Header: row_temp[0][i],\n                    accessor: row_temp[0][i],\n                    sortable: true,\n                    \n                    className: \"font-bold justify-center\",\n                });\n            }\n            console.log(col_setup);\n            for (var i = 1; i < row_temp.length && row_temp[i].length > 1; i++) {\n                var temp = {};\n                for (var j = 0; j < row_temp[i].length; j++) {\n                    temp[row_temp[0][j]] = row_temp[i][j];\n                }\n                row_setup.push(temp);\n            }\n            console.log(row_setup);\n            props.setColumns(col_setup);\n            props.setRows(row_setup);\n        };\n        reader.readAsText(event.target.files[0])\n        setCnt(0);\n    }\n\n    var CLIENT_ID = '1067508074985-pgsioeadhbkpv79l18dvodcunr5cgkp9.apps.googleusercontent.com';\n    var API_KEY = 'AIzaSyAeYEXpe2vPm2gEcYQk_EG6tWLmAjkjtJI';\n\n    var DISCOVERY_DOCS = [\"https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest\"];\n\n    var SCOPES = 'https://mail.google.com/';\n    const [user, setUser] = useState();\n    const handleClientLoad = () => {\n        gapi.load('client:auth2', initClient);\n    };\n    const initClient = () => {\n        setIsLoadingGoogleMailApi(true);\n        gapi.client\n            .init({\n                apiKey: API_KEY,\n                clientId: CLIENT_ID,\n                discoveryDocs: DISCOVERY_DOCS,\n                scope: SCOPES,\n            })\n            .then(\n                function () {\n                    // Listen for sign-in state changes.\n                    gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);\n                    console.log('inside');\n\n                    // Handle the initial sign-in state.\n                    updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());\n                    //gapi.auth2.getAuthInstance().signOut();\n                },\n                function (error) { }\n            );\n    };\n    const updateSigninStatus = (isSignedIn) => {\n        if (isSignedIn) {\n            // Set the signed in user\n            console.log(gapi.auth2.getAuthInstance().currentUser)\n            setSignedInUser(gapi.auth2.getAuthInstance().currentUser.le.wt);\n            setIsLoadingGoogleMailApi(false);\n            setIsApiLoaded(true);\n            // list files if user is authenticated\n            var subject = 'Subject: '+props.subject+'\\n\\n';\n            props.row.map((value) => {\n                var msg = 'To: ' + '<' + value.email + '>' + '\\n';\n                msg += subject + props.body + '\\n' ;\n                for (var i in value) {\n                    if (i == 'email' )\n                        continue;\n                    if (props.list.indexOf(i)==-1)\n                        continue\n                    msg += i;\n                    msg += ' :- ';\n                    msg += value[i];\n                    msg += '\\n';\n                }\n                \n                sendMail(encode(msg));\n            });\n           \n        } else {\n            // prompt user to sign in\n            handleAuthClick();\n        }\n    };\n\n    /**\n    * List files.\n    */\n    function sendMail(message) {\n\n        gapi.client.gmail.users.messages.send({\n            'userId': 'me',\n            \"raw\": message\n        }).then(function (response) {\n            // alert(\"Email sent successfully\");\n        setCnt((prevProgress) => (prevProgress >= 100 ? prevProgress : prevProgress +  (100 / props.row.length) ));\n\n        })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n\n\n    /**\n     *  Sign in the user upon button click.\n     */\n    const handleAuthClick = (event) => {\n        gapi.auth2.getAuthInstance().signIn();\n    };\n    return (\n        <div>\n            <input color=\"inherit\" type=\"file\" accept='.csv' onChange={onFileChange} onClick={()=>{setCnt(0)}}/>\n            <label htmlFor=\"outlined-button-file\">\n    \n            </label>\n            {/* {rows != null && columns != null ? <CourseList columns={columns} data={rows} /> : null} */}\n            <Button variant=\"outlined\" color=\"inherit\" component=\"span\" className={classes.button} onClick={() => { handleClientLoad() }}>\n                Send Email\n            </Button>\n\n            <ListItem>\n                <ProgressBar color ='secondary' progress ={cnt} />\n                <div className='p-5'>\n                    {cnt>=100 ?<DoneAllIcon color='secondary'></DoneAllIcon>:null }\n                </div>\n            </ListItem>\n            \n        </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}