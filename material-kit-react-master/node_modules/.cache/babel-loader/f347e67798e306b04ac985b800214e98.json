{"ast":null,"code":"import _regeneratorRuntime from \"/home/abhishek/Projects/stp/frotend/Fuse-React-v3.0.0-skeleton/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/abhishek/Projects/stp/frotend/Fuse-React-v3.0.0-skeleton/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/abhishek/Projects/stp/frotend/Fuse-React-v3.0.0-skeleton/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/abhishek/Projects/stp/frotend/Fuse-React-v3.0.0-skeleton/src/app/main/academy/crp/tabs/SheetUpload.js\";\nimport Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState, useRef } from 'react';\nimport { readString } from 'react-papaparse';\nimport CourseList from '../usables/CourseList';\nimport axios from 'axios';\nimport { gapi } from 'gapi-script';\nimport { encode, decode } from 'js-base64';\nimport TextField from '@material-ui/core/TextField';\nimport ProgressBar from '../usables/progressbar';\nvar useStyles = makeStyles(function (theme) {\n  return {\n    button: {\n      margin: theme.spacing(1)\n    },\n    input: {\n      display: 'none'\n    }\n  };\n});\nexport default function SheetUpload(props) {\n  var classes = useStyles();\n\n  var _React$useState = React.useState({}),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      fileState = _React$useState2[0],\n      setFileState = _React$useState2[1];\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      signedInUser = _useState2[0],\n      setSignedInUser = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      isLoadingGoogleMailApi = _useState4[0],\n      setIsLoadingGoogleMailApi = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isApiLoaded = _useState6[0],\n      setIsApiLoaded = _useState6[1];\n\n  var _useState7 = useState(0),\n      _useState8 = _slicedToArray(_useState7, 2),\n      cnt = _useState8[0],\n      setCnt = _useState8[1];\n\n  var onFileChange = function onFileChange(event) {\n    setFileState({\n      selectedFile: event.target.files[0]\n    });\n    console.log(event.target.result);\n    var reader = new FileReader();\n\n    reader.onload =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(event) {\n        var text, row_temp, col_setup, row_setup, i, temp, j;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                text = event.target.result;\n                console.log(text);\n                row_temp = readString(text).data;\n                console.log(row_temp);\n                col_setup = [];\n                row_setup = [];\n\n                for (i = 0; i < row_temp[0].length; i++) {\n                  col_setup.push({\n                    Header: row_temp[0][i],\n                    accessor: row_temp[0][i],\n                    sortable: true,\n                    className: \"font-bold justify-center\"\n                  });\n                }\n\n                console.log(col_setup);\n\n                for (i = 1; i < row_temp.length && row_temp[i].length > 1; i++) {\n                  temp = {};\n\n                  for (j = 0; j < row_temp[i].length; j++) {\n                    temp[row_temp[0][j]] = row_temp[i][j];\n                  }\n\n                  row_setup.push(temp);\n                }\n\n                console.log(row_setup);\n                props.setColumns(col_setup);\n                props.setRows(row_setup);\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    reader.readAsText(event.target.files[0]);\n  };\n\n  var onFileUpload = function onFileUpload() {\n    var formData = new FormData();\n    console.log(fileState);\n    formData.append(\"file\", fileState);\n  };\n\n  var CLIENT_ID = '1067508074985-pgsioeadhbkpv79l18dvodcunr5cgkp9.apps.googleusercontent.com';\n  var API_KEY = 'AIzaSyAeYEXpe2vPm2gEcYQk_EG6tWLmAjkjtJI';\n  var DISCOVERY_DOCS = [\"https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest\"];\n  var SCOPES = 'https://mail.google.com/';\n\n  var _useState9 = useState(),\n      _useState10 = _slicedToArray(_useState9, 2),\n      user = _useState10[0],\n      setUser = _useState10[1];\n\n  var handleClientLoad = function handleClientLoad() {\n    gapi.load('client:auth2', initClient);\n  };\n\n  var initClient = function initClient() {\n    setIsLoadingGoogleMailApi(true);\n    gapi.client.init({\n      apiKey: API_KEY,\n      clientId: CLIENT_ID,\n      discoveryDocs: DISCOVERY_DOCS,\n      scope: SCOPES\n    }).then(function () {\n      // Listen for sign-in state changes.\n      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);\n      console.log('inside'); // Handle the initial sign-in state.\n\n      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());\n      gapi.auth2.getAuthInstance().signOut();\n    }, function (error) {});\n  };\n\n  var updateSigninStatus = function updateSigninStatus(isSignedIn) {\n    if (isSignedIn) {\n      // Set the signed in user\n      console.log(gapi.auth2.getAuthInstance().currentUser);\n      setSignedInUser(gapi.auth2.getAuthInstance().currentUser.le.wt);\n      setIsLoadingGoogleMailApi(false);\n      setIsApiLoaded(true); // list files if user is authenticated\n\n      var subject = 'Subject: ' + props.subject + '\\n\\n';\n      props.row.map(function (value) {\n        var msg = 'To: ' + '<' + value.email + '>' + '\\n';\n        msg += subject;\n\n        for (var i in value) {\n          if (i == 'email') continue;\n          msg += i;\n          msg += ' :- ';\n          msg += value[i];\n          msg += '\\n';\n        }\n\n        console.log(value);\n        console.log(msg);\n        console.log(props.list);\n        sendMail(encode(msg)); // console.log(\"Cnt:\",cnt)\n      });\n    } else {\n      // prompt user to sign in\n      handleAuthClick();\n    }\n  };\n  /**\n  * List files.\n  */\n\n\n  function sendMail(message) {\n    gapi.client.gmail.users.messages.send({\n      'userId': 'me',\n      \"raw\": message\n    }).then(function (response) {\n      // alert(\"Email sent successfully\");\n      setCnt(function (prevProgress) {\n        return prevProgress >= 100 ? 0 : prevProgress + 1 / props.row.length;\n      });\n    }).catch(function (err) {\n      console.log(err);\n    });\n  }\n  /**\n   *  Sign in the user upon button click.\n   */\n\n\n  var handleAuthClick = function handleAuthClick(event) {\n    gapi.auth2.getAuthInstance().signIn();\n  };\n\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, React.createElement(\"input\", {\n    color: \"inherit\",\n    type: \"file\",\n    onChange: onFileChange,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }), React.createElement(\"label\", {\n    htmlFor: \"outlined-button-file\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, React.createElement(Button, {\n    variant: \"outlined\",\n    color: \"inherit\",\n    component: \"span\",\n    className: classes.button,\n    onClick: onFileUpload,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, \"Upload\")), React.createElement(Button, {\n    variant: \"outlined\",\n    color: \"inherit\",\n    component: \"span\",\n    className: classes.button,\n    onClick: function onClick() {\n      handleClientLoad();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, \"Send Email\"), React.createElement(ProgressBar, {\n    progress: cnt,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }));\n}","map":{"version":3,"sources":["/home/abhishek/Projects/stp/frotend/Fuse-React-v3.0.0-skeleton/src/app/main/academy/crp/tabs/SheetUpload.js"],"names":["Button","makeStyles","React","useEffect","useState","useRef","readString","CourseList","axios","gapi","encode","decode","TextField","ProgressBar","useStyles","theme","button","margin","spacing","input","display","SheetUpload","props","classes","fileState","setFileState","signedInUser","setSignedInUser","isLoadingGoogleMailApi","setIsLoadingGoogleMailApi","isApiLoaded","setIsApiLoaded","cnt","setCnt","onFileChange","event","selectedFile","target","files","console","log","result","reader","FileReader","onload","text","row_temp","data","col_setup","row_setup","i","length","push","Header","accessor","sortable","className","temp","j","setColumns","setRows","readAsText","onFileUpload","formData","FormData","append","CLIENT_ID","API_KEY","DISCOVERY_DOCS","SCOPES","user","setUser","handleClientLoad","load","initClient","client","init","apiKey","clientId","discoveryDocs","scope","then","auth2","getAuthInstance","isSignedIn","listen","updateSigninStatus","get","signOut","error","currentUser","le","wt","subject","row","map","value","msg","email","list","sendMail","handleAuthClick","message","gmail","users","messages","send","response","prevProgress","catch","err","signIn"],"mappings":"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","sourcesContent":["import Button from '@material-ui/core/Button';\nimport { makeStyles } from '@material-ui/core/styles';\nimport React, { useEffect, useState, useRef } from 'react';\nimport { readString } from 'react-papaparse';\nimport CourseList from '../usables/CourseList'\nimport axios from 'axios';\nimport { gapi } from 'gapi-script';\nimport { encode, decode } from 'js-base64';\nimport TextField from '@material-ui/core/TextField';\nimport ProgressBar from '../usables/progressbar';\n\n\nconst useStyles = makeStyles(theme => ({\n    button: {\n        margin: theme.spacing(1),\n    },\n    input: {\n        display: 'none',\n    },\n}));\nexport default function SheetUpload(props) {\n    const classes = useStyles();\n    const [fileState, setFileState] = React.useState({});\n    const [signedInUser, setSignedInUser] = useState();\n    const [isLoadingGoogleMailApi, setIsLoadingGoogleMailApi] = useState(false);\n    const [isApiLoaded, setIsApiLoaded] = useState(false);\n    const [cnt, setCnt] = useState(0);\n    const onFileChange = (event) => {\n        setFileState({ selectedFile: event.target.files[0] });\n        console.log(event.target.result);\n        const reader = new FileReader()\n        reader.onload = async (event) => {\n            const text = (event.target.result)\n            console.log(text);\n            var row_temp = readString(text).data;\n            console.log(row_temp);\n            var col_setup = [];\n            var row_setup = [];\n            for (var i = 0; i < row_temp[0].length; i++) {\n                col_setup.push({\n                    Header: row_temp[0][i],\n                    accessor: row_temp[0][i],\n                    sortable: true,\n                    className: \"font-bold justify-center\",\n                });\n            }\n            console.log(col_setup);\n            for (var i = 1; i < row_temp.length && row_temp[i].length > 1; i++) {\n                var temp = {};\n                for (var j = 0; j < row_temp[i].length; j++) {\n                    temp[row_temp[0][j]] = row_temp[i][j];\n                }\n                row_setup.push(temp);\n            }\n            console.log(row_setup);\n            props.setColumns(col_setup);\n            props.setRows(row_setup);\n        };\n        reader.readAsText(event.target.files[0])\n    }\n    const onFileUpload = () => {\n        const formData = new FormData();\n        console.log(fileState);\n        formData.append(\"file\", fileState);\n    }\n    var CLIENT_ID = '1067508074985-pgsioeadhbkpv79l18dvodcunr5cgkp9.apps.googleusercontent.com';\n    var API_KEY = 'AIzaSyAeYEXpe2vPm2gEcYQk_EG6tWLmAjkjtJI';\n\n    var DISCOVERY_DOCS = [\"https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest\"];\n\n    var SCOPES = 'https://mail.google.com/';\n    const [user, setUser] = useState();\n    const handleClientLoad = () => {\n        gapi.load('client:auth2', initClient);\n    };\n    const initClient = () => {\n        setIsLoadingGoogleMailApi(true);\n        gapi.client\n            .init({\n                apiKey: API_KEY,\n                clientId: CLIENT_ID,\n                discoveryDocs: DISCOVERY_DOCS,\n                scope: SCOPES,\n            })\n            .then(\n                function () {\n                    // Listen for sign-in state changes.\n                    gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);\n                    console.log('inside');\n\n                    // Handle the initial sign-in state.\n                    updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());\n                    gapi.auth2.getAuthInstance().signOut();\n\n                },\n                function (error) { }\n            );\n    };\n    const updateSigninStatus = (isSignedIn) => {\n        if (isSignedIn) {\n            // Set the signed in user\n            console.log(gapi.auth2.getAuthInstance().currentUser)\n            setSignedInUser(gapi.auth2.getAuthInstance().currentUser.le.wt);\n            setIsLoadingGoogleMailApi(false);\n            setIsApiLoaded(true);\n            // list files if user is authenticated\n            var subject = 'Subject: '+props.subject+'\\n\\n';\n            props.row.map((value) => {\n                var msg = 'To: ' + '<' + value.email + '>' + '\\n';\n                msg += subject;\n                for (var i in value) {\n                    if (i == 'email' )\n                        continue;\n                    msg += i;\n                    msg += ' :- ';\n                    msg += value[i];\n                    msg += '\\n';\n                }\n                console.log(value);\n                console.log(msg);\n                console.log(props.list);\n                sendMail(encode(msg));\n                // console.log(\"Cnt:\",cnt)\n            });\n        } else {\n            // prompt user to sign in\n            handleAuthClick();\n        }\n    };\n\n    /**\n    * List files.\n    */\n    function sendMail(message) {\n        gapi.client.gmail.users.messages.send({\n            'userId': 'me',\n            \"raw\": message\n        }).then(function (response) {\n            // alert(\"Email sent successfully\");\n            setCnt((prevProgress) => (prevProgress >= 100 ? 0 : prevProgress + (1/props.row.length) ));\n\n        })\n            .catch((err) => {\n                console.log(err);\n            });\n    }\n\n\n    /**\n     *  Sign in the user upon button click.\n     */\n    const handleAuthClick = (event) => {\n        gapi.auth2.getAuthInstance().signIn();\n    };\n    return (\n        <div>\n            <input color=\"inherit\" type=\"file\" onChange={onFileChange} />\n            <label htmlFor=\"outlined-button-file\">\n                <Button variant=\"outlined\" color=\"inherit\" component=\"span\" className={classes.button} onClick={onFileUpload}>\n                    Upload\n        </Button>\n\n\n            </label>\n            {/* {rows != null && columns != null ? <CourseList columns={columns} data={rows} /> : null} */}\n            <Button variant=\"outlined\" color=\"inherit\" component=\"span\" className={classes.button} onClick={() => { handleClientLoad() }}>\n                Send Email\n            </Button>\n\n            <ProgressBar progress ={cnt} />\n\n        </div>\n    );\n}"]},"metadata":{},"sourceType":"module"}